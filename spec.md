# Metadata Search — Project Spec

## Objective

Video scene search service using OpenSearch as both a search engine (BM25) and vector database (k-NN). Scenes are stored as flattened documents carrying their parent video metadata, enabling efficient search without joins.

## Architecture

- **Framework:** FastAPI + Uvicorn
- **Search engine:** OpenSearch 2.10+ with ML plugin
- **Data model:** Flattened — each document = 1 scene + video metadata
- **Embedding:** Auto-generated by OpenSearch ingest pipeline from `scene_description + video_title`
- **Vector search:** HNSW (Lucene engine), cosine similarity, 768 dimensions

## Data Flow

```
Ingest:  Client → POST /v1/scenes/ingest (raw text) → OpenSearch ingest pipeline → embedding auto-generated → indexed

Search:  Client → POST /v1/search/* (text query) → OpenSearch neural query → model converts text → k-NN search → results
```

## Configuration

Environment variables with `MS_` prefix:

| Variable | Default | Description |
|---|---|---|
| `MS_OPENSEARCH_HOST` | `localhost` | OpenSearch host |
| `MS_OPENSEARCH_PORT` | `9200` | OpenSearch port |
| `MS_OPENSEARCH_USER` | `admin` | Auth user |
| `MS_OPENSEARCH_PASSWORD` | `admin` | Auth password |
| `MS_MODEL_ID` | *(required)* | Pre-deployed ML model ID |
| `MS_INDEX_NAME` | `scenes` | Index name |
| `MS_EMBEDDING_DIMENSION` | `768` | Vector dimension |

## Running

```bash
export MS_MODEL_ID=<your-model-id>
uvicorn api.main:app --reload
```
